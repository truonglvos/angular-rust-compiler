[package]
name = "angular-compiler"
version.workspace = true
edition.workspace = true

[lib]
name = "angular_compiler"
crate-type = ["cdylib", "rlib"]

[dependencies]
# Workspace dependencies
serde = { workspace = true }
serde_json = { workspace = true }
indexmap = { workspace = true }
regex = { workspace = true }
once_cell = { workspace = true }
anyhow = { workspace = true }
thiserror = { workspace = true }
rayon = { workspace = true }
smallvec = { workspace = true }
bitflags = { workspace = true }

# Lazy static for placeholder serializers
lazy_static = "1.4"

# NAPI-RS for Node.js bindings (optional)
napi = { workspace = true, optional = true }
napi-derive = { workspace = true, optional = true }

[build-dependencies]
napi-build = "2.1"

[features]
default = []
napi-bindings = ["napi", "napi-derive"]

# Integration tests in test/ directory (matching TypeScript structure)
[[test]]
name = "expression_parser_lexer"
path = "test/expression_parser/lexer_tests.rs"

[[test]]
name = "expression_parser_parser"
path = "test/expression_parser/parser_tests.rs"

[[test]]
name = "expression_parser_ast"
path = "test/expression_parser/ast_tests.rs"

[[test]]
name = "expression_parser_serializer"
path = "test/expression_parser/serializer_tests.rs"

# ML Parser tests
[[test]]
name = "ml_parser_lexer"
path = "test/ml_parser/lexer_tests.rs"

[[test]]
name = "ml_parser_html_parser"
path = "test/ml_parser/html_parser_tests.rs"

[[test]]
name = "ml_parser_html_whitespaces"
path = "test/ml_parser/html_whitespaces_tests.rs"

[[test]]
name = "ml_parser_ast_serializer"
path = "test/ml_parser/ast_serializer_tests.rs"

[[test]]
name = "util_spec"
path = "test/util_spec.rs"

       [[test]]
       name = "style_url_resolver_spec"
       path = "test/style_url_resolver_spec.rs"

       [[test]]
       name = "shadow_css_repeat_groups_spec"
       path = "test/shadow_css/repeat_groups_spec.rs"

       [[test]]
       name = "shadow_css_process_rules_spec"
       path = "test/shadow_css/process_rules_spec.rs"

       [[test]]
       name = "shadow_css_ng_deep_spec"
       path = "test/shadow_css/ng_deep_spec.rs"

       [[test]]
       name = "shadow_css_polyfills_spec"
       path = "test/shadow_css/polyfills_spec.rs"

       [[test]]
       name = "shadow_css_spec"
       path = "test/shadow_css/shadow_css_spec.rs"

       [[test]]
       name = "shadow_css_at_rules_spec"
       path = "test/shadow_css/at_rules_spec.rs"

       [[test]]
       name = "shadow_css_host_and_host_context_spec"
       path = "test/shadow_css/host_and_host_context_spec.rs"

       [[test]]
       name = "shadow_css_keyframes_spec"
       path = "test/shadow_css/keyframes_spec.rs"

       [[test]]
       name = "output_source_map_tests"
       path = "test/output/source_map_tests.rs"

       [[test]]
       name = "output_abstract_emitter_node_only_tests"
       path = "test/output/abstract_emitter_node_only_tests.rs"

       [[test]]
       name = "output_abstract_emitter_tests"
       path = "test/output/abstract_emitter_tests.rs"

       [[test]]
       name = "output_jit_tests"
       path = "test/output/output_jit_tests.rs"

       [[test]]
       name = "selector_tests"
       path = "test/selector/selector_tests.rs"

[profile.release]
opt-level = 3
lto = true
codegen-units = 1
strip = true

